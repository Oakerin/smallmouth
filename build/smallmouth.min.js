/*! smallmouth v0.0.1 */
var SmallMouth;!function(a){function b(a,c){if(!(c instanceof Object)||c instanceof String||c instanceof Number||c instanceof Array||c instanceof Boolean)a.data=c;else{a.children||(a.children={});for(var d in c)c.hasOwnProperty(d)&&(a.children.hasOwnProperty(d)?a.children[d].version++:a.children[d]={children:{},version:0},b(a.children[d],c[d]))}}function c(a,b){if(b||(b={}),""==a.trim())return i;for(var c=a.split("/"),d=i,e=0,f=c.length;f>e;e++)d.children||(d.children={}),d.children[c[e]]||(d.children[c[e]]={version:0}),b.versionUpdate&&d.version++,d=d.children[c[e]];return d}function d(a,d,e){"undefined"==typeof e&&(e={});var g=c(a._path,{versionUpdate:!0});e.merge||(g.children={},g.data=null),b(g,d),g.version++,f(a)}function e(a){c(a._path),f(a)}function f(){h&&clearTimeout(h),h=setTimeout(function(){localStorage.setItem("LargeMouth_Registry",JSON.stringify(i))},100)}function g(){i.data=null,i.children={},i.version=0,localStorage.setItem("LargeMouth_Registry",JSON.stringify(i))}var h,i=JSON.parse(localStorage.getItem("LargeMouth_Registry"))||{version:0};a._registry={sync:f,initializeRegistry:e,updateRegistry:d,getData:c,dataRegistry:i,resetRegistry:g}}(SmallMouth||(SmallMouth={}));var SmallMouth;!function(a){var b=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(([^#]*))?(#(.*))?"),c={},d=function(){function d(e){this._callbacks=[];var f=b.exec(e),g=f[1],h=f[3],i=f[5],j=f[6],k=(g?g:"")+(h?h:""),l=d.cleanPath((i?i:"")+(j?j:"")),m=c[k];this._path=l,this._host=k,this._socket=m?m:m=c[k]=io.connect(k),a._registry.initializeRegistry(this)}return d.prototype.on=function(a,b,c,d){return this._callbacks.push({type:a,callback:function(){return b.call(d,null)}}),this},d.prototype.set=function(b){return a._registry.updateRegistry(this,b),this},d.prototype.update=function(b){return a._registry.updateRegistry(this,b,{merge:!0}),this},d.prototype.child=function(a){return new d(this._host+"/"+this._path+"/"+d.cleanPath(a))},d.prototype.parent=function(){return new d(this._host+"/"+this._path.substring(0,this._path.lastIndexOf("/")))},d.prototype.root=function(){return new d(this._host+"/"+this._path.substring(0,this._path.indexOf("/")))},d.prototype.name=function(){return this._path.substring(this._path.lastIndexOf("/")+1)},d.prototype.toString=function(){return this._path},d.cleanPath=function(a){return a="/"===a.charAt(0)?a.substring(1):a,a="/"===a.charAt(a.length-1)?a.substring(0,a.length-1):a},d.prototype._getSnapshot=function(){var b=a._registry.getData(this._path);return b?new a.Snapshot(this._path,b,this._host):void 0},d}();a.Resource=d}(SmallMouth||(SmallMouth={}));var SmallMouth;!function(a){function b(a){var c={};if(a.data)return a.data;if(!a.children)return null;for(var d in a.children)a.children.hasOwnProperty(d)&&(c[d]=b(a.children[d]));return c}var c=function(){function c(a,b,c){this._path=a,this._host=c,this._data=JSON.parse(JSON.stringify(b)),this.version=b.version}return c.prototype.val=function(){return b(this._data)},c.prototype.child=function(b){b=this._path+"/"+a.Resource.cleanPath(b);var d=a._registry.getData(b);return d?new c(b,d,this._host):void 0},c.prototype.forEach=function(b){var d=this._data.children;for(var e in d)if(d.hasOwnProperty(e)){var f=this._path+"/"+e,g=b.call(this,new c(f,a._registry.getData(f),this._host));if(g)return!0}return!1},c.prototype.hasChild=function(b){b=this._path+"/"+a.Resource.cleanPath(b);var c=a._registry.getData(b);return"undefined"!=typeof c.children||"undefined"!=typeof c.data},c.prototype.hasChildren=function(){return this.numChildren()>0},c.prototype.name=function(){return this._path.substring(this._path.lastIndexOf("/")+1)},c.prototype.numChildren=function(){return this._data.children?Object.keys(this._data.children).length:0},c.prototype.ref=function(){return new a.Resource(this._host+"/"+this._path)},c}();a.Snapshot=c}(SmallMouth||(SmallMouth={}));