/*! smallmouth v0.1.11 */
var SmallMouth;!function(a){!function(b){function c(a,b){if(!(b instanceof Object)||b instanceof String||b instanceof Number||b instanceof Array||b instanceof Boolean)a.value=b;else{a.children||(a.children={});for(var d in b)b.hasOwnProperty(d)&&(a.children.hasOwnProperty(d)?a.children[d].version++:a.children[d]={children:{},version:0},c(a.children[d],b[d]))}}function d(a,b){if(b||(b={}),""==a.trim())return o;for(var c=a.split("/"),d=o,e=0,f=c.length;f>e;e++)d.children||(d.children={}),d.children[c[e]]||(d.children[c[e]]={version:0}),b.versionUpdate&&d.version++,d=d.children[c[e]];return d}function e(a,b,e){"undefined"==typeof e&&(e={});var f=d(a._path),g=JSON.parse(JSON.stringify(f));if(e.merge||(f.children={},f.value=null),c(f,b),!n(f,g)){var f=d(a._path,{versionUpdate:!0});return f.version++,j(a,e.onComplete),!0}return!1}function f(a,b){var c=d(a,{versionUpdate:!0});b&&h(c,b),localStorage.setItem("LargeMouth_Registry",JSON.stringify(o))}function g(a,b){var c=d(a,{versionUpdate:!0});c.children={},b&&h(c,b),localStorage.setItem("LargeMouth_Registry",JSON.stringify(o))}function h(a,b){if(a.version=b.version,b.value)a.value=b.value;else{a.children||(a.children={});for(var c in b.children)b.children.hasOwnProperty(c)&&(a.children[c]||(a.children[c]={version:0}),h(a.children[c],b.children[c]))}}function i(a){return d(a._path)}function j(b,c){localStorage.setItem("LargeMouth_Registry",JSON.stringify(o)),b._host&&a.largeMouthAdapter.syncRemote(b._host,d(b._path),b._path,c)}function k(){o.value=null,o.children={},o.version=0,localStorage.setItem("LargeMouth_Registry",JSON.stringify(o))}function l(a,b){"undefined"==typeof b&&(b={});var c=a._path;if(""==c.trim())return o;for(var d=c.split("/"),e=o,f=0,g=d.length-1;g>f&&e.children;f++)e=e.children[d[f]],e.version++;delete e.children,delete e.value,a._host&&j(a,b.onComplete)}function m(a){for(var b=a.split("/"),c=o,d=[],e=0,f=b.length;f>e&&c&&(d.push(c.version),c.children);e++)c=c.children[b[e]];return d}var n=function(a,b){return function c(a,b,d,e){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;var f=toString.call(a);if(f!=toString.call(b))return!1;switch(f){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var g=d.length;g--;)if(d[g]==a)return e[g]==b;var h=a.constructor,i=b.constructor;if(h!==i&&"function"!=typeof h&&h instanceof h&&"function"==typeof i&&i instanceof i)return!1;d.push(a),e.push(b);var j=0,k=!0;if("[object Array]"==f){if(j=a.length,k=j==b.length)for(;j--&&(k=c(a[j],b[j],d,e)););}else{for(var l in a)if(Object.hasOwnProperty.call(a,l)&&(j++,!(k=Object.hasOwnProperty.call(b,l)&&c(a[l],b[l],d,e))))break;if(k){for(l in b)if(Object.hasOwnProperty.call(b,l)&&!j--)break;k=!j}}return d.pop(),e.pop(),k}(a,b,[],[])},o=JSON.parse(localStorage.getItem("LargeMouth_Registry"))||{version:0};b.initializeRegistry=i,b.updateRegistry=e,b.getData=d,b.dataRegistry=o,b.resetRegistry=k,b.remove=l,b.getVersions=m,b.serverUpdateData=f,b.serverSetData=g}(a._dataRegistry||(a._dataRegistry={})),a._dataRegistry}(SmallMouth||(SmallMouth={}));var SmallMouth;!function(a){!function(b){function c(b,c){"undefined"==typeof c&&(c={});for(var d=h,e=b.split("/"),f=e[0],g=0,i=e.length;i>g;g++){if(d.children[e[g]]||(d.children[e[g]]={events:{},children:{}}),"undefined"!=typeof c.trigger){var j=d.events[c.trigger];if(j)for(var k=a._dataRegistry.getData(f),l=new a.Snapshot(f,k,c.host),m=0,n=j.length;n>m;m++)j[m].callback.call(j[m].context,l,c)}d=d.children[e[g]],g&&(f=f+"/"+e[g])}return d}function d(a,b,d,e){var f=c(a);f.events[b]||(f.events[b]=[]),f.events[b].push({callback:d,context:e})}function e(a,b,d){var e,f=c(a);if("undefined"!=typeof b&&null!==b){if(f.events[b]){if("function"!=typeof d)return f.events[b].length=0;for(var g=0,h=f.events[b].length;h>g;g++)if(f.events[b][g].callback===d){e=g;break}"undefined"!=typeof e&&f.events[b].splice(e,1)}}else for(var i=Object.keys(f.events),g=0,h=i.length;h>g;g++)delete f.events[i[g]]}function f(a,b,d,e,f){"undefined"==typeof f&&(f={});var g=c(a,{trigger:b,host:d,remote:f.remote}),h=g.events[b];if(h)for(var i=0,j=h.length;j>i;i++)h[i].callback.call(h[i].context,e,f)}function g(){h.events={},h.children={}}var h={events:{},children:{}};b.addEvent=d,b.removeEvent=e,b.triggerEvent=f,b.resetRegistry=g,b.eventRegistry=h}(a._eventRegistry||(a._eventRegistry={})),a._eventRegistry}(SmallMouth||(SmallMouth={}));var SmallMouth;!function(a){!function(b){function c(b){var c;if(b)return j[b]?c=j[b]:(c=j[b]=io.connect(b),c.on("data",function(){}),c.on("set",function(c){a._dataRegistry.serverSetData(c.path,c.value);var d=a._dataRegistry.getData(c.path);a._eventRegistry.triggerEvent(c.path,"value",b,new a.Snapshot(c.path,d,b),{remote:!0})}),c.on("update",function(c){a._dataRegistry.serverUpdateData(c.path,c.value);var d=a._dataRegistry.getData(c.path);a._eventRegistry.triggerEvent(c.path,"value",b,new a.Snapshot(c.path,d,b),{remote:!0})}),c.on("syncComplete",function(a){f(a.reqId,a.err)}),c.on("ready",function(a){j[b].id=a.id}),c)}function d(b,c){var d=j[b];d&&d.emit("subscribe",{url:c,value:a._dataRegistry.getData(c)})}function e(a,b,c,d){var e=j[a];if(e){var f=h();k[f]=d,e.emit("set",{url:c,value:b,reqId:f})}}function f(a,b){"function"==typeof k[a]&&(k[a](b),delete k[a])}function g(a){var b=(new Date).getTime()+"";return a&&(b=j[a].id+"-"+b),b}function h(){return++i}var i=0,j={},k={};b.connect=c,b.subscribe=d,b.syncRemote=e,b.generateId=g}(a.largeMouthAdapter||(a.largeMouthAdapter={})),a.largeMouthAdapter}(SmallMouth||(SmallMouth={}));var SmallMouth;!function(a){var b=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(([^#]*))?(#(.*))?"),c=function(){function c(d){var e=b.exec(d),f=e[1],g=e[3],h=e[5],i=e[6],j=(f?f:"")+(g?g:""),k=c.cleanPath((h?h:"")+(i?i:""));this._path=k,this._host=j,a._dataRegistry.initializeRegistry(this),a.largeMouthAdapter.connect(j),a.largeMouthAdapter.subscribe(j,k)}return c.prototype.on=function(b,c,d,e){return"function"==typeof d?(a._eventRegistry.addEvent(this._path,b,c,e),a._eventRegistry.addEvent(this._path,"cancel",d,e),c.call(e,this._getSnapshot())):(a._eventRegistry.addEvent(this._path,b,c,d),c.call(d,this._getSnapshot())),this},c.prototype.off=function(b,c){return a._eventRegistry.removeEvent(this._path,b,c),this},c.prototype.set=function(b,c){var d=a._dataRegistry.updateRegistry(this,b,{onComplete:c});return d&&a._eventRegistry.triggerEvent(this._path,"value",this._host,this._getSnapshot()),this},c.prototype.update=function(b,c){var d=a._dataRegistry.updateRegistry(this,b,{merge:!0,onComplete:c});return d&&a._eventRegistry.triggerEvent(this._path,"value",this._host,this._getSnapshot()),this},c.prototype.remove=function(b){a._dataRegistry.remove(this,{onComplete:b}),a._eventRegistry.triggerEvent(this._path,"value",this._host,this._getSnapshot())},c.prototype.push=function(b){var c=a.largeMouthAdapter.generateId(this._host),d=this.child(c);return"undefined"!=typeof b&&d.set(b),d},c.prototype.child=function(a){return new c(this._host+"/"+this._path+"/"+c.cleanPath(a))},c.prototype.parent=function(){return new c(this._host+"/"+this._path.substring(0,this._path.lastIndexOf("/")))},c.prototype.root=function(){return new c(this._host+"/"+this._path.substring(0,this._path.indexOf("/")))},c.prototype.name=function(){return this._path.substring(this._path.lastIndexOf("/")+1)},c.prototype.toString=function(){return this._path},c.cleanPath=function(a){return a="/"===a.charAt(0)?a.substring(1):a,a="/"===a.charAt(a.length-1)?a.substring(0,a.length-1):a},c.prototype._getSnapshot=function(){var b=a._dataRegistry.getData(this._path);return b?new a.Snapshot(this._path,b,this._host):void 0},c}();a.Resource=c}(SmallMouth||(SmallMouth={}));var SmallMouth;!function(a){function b(a){var c={};if("undefined"!=typeof a.value&&null!=a.value)return a.value;if(!a.children||!Object.keys(a.children).length)return null;for(var d in a.children)a.children.hasOwnProperty(d)&&(c[d]=b(a.children[d]));return c}var c=function(){function c(a,b,c){this._path=a,this._host=c,this._data=JSON.parse(JSON.stringify(b)),this.version=b.version}return c.prototype.val=function(){return b(this._data)},c.prototype.child=function(b){b=this._path+"/"+a.Resource.cleanPath(b);var d=a._dataRegistry.getData(b);return d?new c(b,d,this._host):void 0},c.prototype.forEach=function(b){var d=this._data.children;for(var e in d)if(d.hasOwnProperty(e)){var f=this._path+"/"+e,g=b.call(this,new c(f,a._dataRegistry.getData(f),this._host));if(g)return!0}return!1},c.prototype.hasChild=function(b){b=this._path+"/"+a.Resource.cleanPath(b);var c=a._dataRegistry.getData(b);return"undefined"!=typeof c.children||"undefined"!=typeof c.value},c.prototype.hasChildren=function(){return this.numChildren()>0},c.prototype.name=function(){return this._path.substring(this._path.lastIndexOf("/")+1)},c.prototype.numChildren=function(){return this._data.children?Object.keys(this._data.children).length:0},c.prototype.ref=function(){return new a.Resource(this._host+"/"+this._path)},c}();a.Snapshot=c}(SmallMouth||(SmallMouth={}));