/*! smallmouth v0.0.1 */
var SmallMouth;!function(a){function b(b){var c;if(b)return c=o[b]?o[b]:o[b]=io.connect(b),c.on("data",function(c){e(c.path,c.value);var d=a._registry.getData(c.path);m(c.path,"value",new a.Snapshot(c.path,d,b))}),c}function c(a,b){if(!(b instanceof Object)||b instanceof String||b instanceof Number||b instanceof Array||b instanceof Boolean)a.data=b;else{a.children||(a.children={});for(var d in b)b.hasOwnProperty(d)&&(a.children.hasOwnProperty(d)?a.children[d].version++:a.children[d]={children:{},version:0},c(a.children[d],b[d]))}}function d(a,b){if(b||(b={}),""==a.trim())return p;for(var c=a.split("/"),d=p,e=0,f=c.length;f>e;e++)d.children||(d.children={}),d.children[c[e]]||(d.children[c[e]]={version:0}),b.versionUpdate&&d.version++,d=d.children[c[e]];return d}function e(a,b,e){"undefined"==typeof e&&(e={});var f=d(a,{versionUpdate:!0});e.merge||(f.children={},f.data=null),c(f,b),f.version++}function f(a){d(a._path),g(a)}function g(){n&&clearTimeout(n),n=setTimeout(function(){localStorage.setItem("LargeMouth_Registry",JSON.stringify(p))},100)}function h(){p.data=null,p.children={},p.version=0,localStorage.setItem("LargeMouth_Registry",JSON.stringify(p)),q.events={},q.children={}}function i(a){if(""==a.trim())return p;for(var b=a.split("/"),c=p,d=0,e=b.length-1;e>d&&c.children;d++)c=c.children[b[d]],c.version++;delete c.children,delete c.data}function j(a){for(var b=q,c=a.split("/"),d=0,e=c.length;e>d;d++)b.children[c[d]]||(b.children[c[d]]={events:{},children:{}}),b=b.children[c[d]];return b}function k(a,b,c,d){var e=j(a);e.events[b]||(e.events[b]=[]),e.events[b].push({callback:c,context:d})}function l(a,b,c){var d,e=j(a);if(e.events[b]){for(var f=0,g=e.events[b].length;g>f;f++)if(e.events[b][f].callback===c){d=f;break}"undefined"!=typeof d&&e.events[b].splice(d,1)}}function m(a,b,c){var d=j(a),e=d.events[b];if(e)for(var f=0,g=e.length;g>f;f++)e[f].callback.call(e[f].context,c)}var n,o={},p=JSON.parse(localStorage.getItem("LargeMouth_Registry"))||{version:0},q={events:{},children:{}};a._registry={connect:b,initializeRegistry:f,updateRegistry:e,getData:d,dataRegistry:p,eventRegistry:q,resetRegistries:h,remove:i,addEvent:k,removeEvent:l,triggerEvent:m}}(SmallMouth||(SmallMouth={}));var SmallMouth;!function(a){var b=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(([^#]*))?(#(.*))?"),c=function(){function c(d){var e=b.exec(d),f=e[1],g=e[3],h=e[5],i=e[6],j=(f?f:"")+(g?g:""),k=c.cleanPath((h?h:"")+(i?i:""));this._path=k,this._host=j,a._registry.initializeRegistry(this);var l=a._registry.connect(j);l&&l.emit("subscribe",k)}return c.prototype.on=function(b,c,d,e){return"function"==typeof d?(a._registry.addEvent(this._path,b,c,e),a._registry.addEvent(this._path,"cancel",d,e)):a._registry.addEvent(this._path,b,c,d),this},c.prototype.off=function(b,c){return a._registry.removeEvent(this._path,b,c),this},c.prototype.set=function(b){return a._registry.updateRegistry(this._path,b),a._registry.triggerEvent(this._path,"value",this._getSnapshot()),this},c.prototype.update=function(b){return a._registry.updateRegistry(this._path,b,{merge:!0}),this},c.prototype.remove=function(){a._registry.remove(this._path)},c.prototype.child=function(a){return new c(this._host+"/"+this._path+"/"+c.cleanPath(a))},c.prototype.parent=function(){return new c(this._host+"/"+this._path.substring(0,this._path.lastIndexOf("/")))},c.prototype.root=function(){return new c(this._host+"/"+this._path.substring(0,this._path.indexOf("/")))},c.prototype.name=function(){return this._path.substring(this._path.lastIndexOf("/")+1)},c.prototype.toString=function(){return this._path},c.cleanPath=function(a){return a="/"===a.charAt(0)?a.substring(1):a,a="/"===a.charAt(a.length-1)?a.substring(0,a.length-1):a},c.prototype._getSnapshot=function(){var b=a._registry.getData(this._path);return b?new a.Snapshot(this._path,b,this._host):void 0},c}();a.Resource=c}(SmallMouth||(SmallMouth={}));var SmallMouth;!function(a){function b(a){var c={};if(a.data)return a.data;if(!a.children)return null;for(var d in a.children)a.children.hasOwnProperty(d)&&(c[d]=b(a.children[d]));return c}var c=function(){function c(a,b,c){this._path=a,this._host=c,this._data=JSON.parse(JSON.stringify(b)),this.version=b.version}return c.prototype.val=function(){return b(this._data)},c.prototype.child=function(b){b=this._path+"/"+a.Resource.cleanPath(b);var d=a._registry.getData(b);return d?new c(b,d,this._host):void 0},c.prototype.forEach=function(b){var d=this._data.children;for(var e in d)if(d.hasOwnProperty(e)){var f=this._path+"/"+e,g=b.call(this,new c(f,a._registry.getData(f),this._host));if(g)return!0}return!1},c.prototype.hasChild=function(b){b=this._path+"/"+a.Resource.cleanPath(b);var c=a._registry.getData(b);return"undefined"!=typeof c.children||"undefined"!=typeof c.data},c.prototype.hasChildren=function(){return this.numChildren()>0},c.prototype.name=function(){return this._path.substring(this._path.lastIndexOf("/")+1)},c.prototype.numChildren=function(){return this._data.children?Object.keys(this._data.children).length:0},c.prototype.ref=function(){return new a.Resource(this._host+"/"+this._path)},c}();a.Snapshot=c}(SmallMouth||(SmallMouth={}));